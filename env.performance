# ===================================
# PERFORMANCE OPTIMIZATION SETTINGS
# ===================================

# Worker Pool Configuration
WORKER_POOL_MIN=2
WORKER_POOL_MAX=16
WORKER_IDLE_TIMEOUT=30000
WORKER_MAX_TASKS=10
WORKER_TASK_TIMEOUT=120000
WORKER_AUTO_SCALE=true
WORKER_SCALE_UP_THRESHOLD=80
WORKER_SCALE_DOWN_THRESHOLD=20

# Memory Limits
NODE_MAX_HEAP_SIZE=1024
MEMORY_WARNING_THRESHOLD=768
MEMORY_CRITICAL_THRESHOLD=896
MEMORY_MONITORING=true
MEMORY_CHECK_INTERVAL=30000
MEMORY_FORCE_GC=true
MAX_BUFFER_SIZE=50

# CPU Limits
CPU_MAX_USAGE=90
CPU_WARNING_THRESHOLD=70
CPU_CRITICAL_THRESHOLD=85
CPU_CHECK_INTERVAL=10000
CPU_THROTTLING=true
CPU_THROTTLE_DELAY=100

# HTTP Timeouts
HTTP_CONNECT_TIMEOUT=5000
HTTP_RESPONSE_TIMEOUT=30000
HTTP_KEEPALIVE_TIMEOUT=5000
HTTP_REQUEST_TIMEOUT=120000

# Database Timeouts
DB_CONNECT_TIMEOUT=10000
DB_QUERY_TIMEOUT=30000
DB_TRANSACTION_TIMEOUT=60000
DB_POOL_TIMEOUT=10000

# File Operation Timeouts
FILE_READ_TIMEOUT=30000
FILE_WRITE_TIMEOUT=60000
FILE_UPLOAD_TIMEOUT=300000
FILE_PROCESSING_TIMEOUT=600000

# AI Operation Timeouts
AI_GENERATION_TIMEOUT=180000
AI_ANALYSIS_TIMEOUT=120000
AI_EMBEDDING_TIMEOUT=60000
AI_SEARCH_TIMEOUT=30000

# Cache Timeouts
CACHE_READ_TIMEOUT=1000
CACHE_WRITE_TIMEOUT=2000
CACHE_DELETE_TIMEOUT=1000

# Optimization Settings
ENABLE_COMPRESSION=true
COMPRESSION_THRESHOLD=1024
ENABLE_HTTP2=true
ENABLE_STATIC_CACHE=true
STATIC_CACHE_TTL=86400
ENABLE_PRELOAD=true

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW=60000
RATE_LIMIT_MAX=100
RATE_LIMIT_SKIP_SUCCESSFUL=false
RATE_LIMIT_SKIP_FAILED=false

# ===================================
# HORIZONTAL SCALING CONFIGURATION
# ===================================

# Scaling Mode (kubernetes, swarm, pm2, manual)
SCALING_MODE=pm2

# General Scaling Settings
MIN_INSTANCES=1
MAX_INSTANCES=10
DESIRED_INSTANCES=2
AUTO_SCALE=true
METRICS_INTERVAL=30000
SCALE_DELAY=60000
STABILIZATION_PERIOD=300000

# CPU Scaling Metrics
CPU_SCALING_ENABLED=true
CPU_SCALE_UP=70
CPU_SCALE_DOWN=20
CPU_AVERAGE_PERIOD=300000

# Memory Scaling Metrics
MEMORY_SCALING_ENABLED=true
MEMORY_SCALE_UP=80
MEMORY_SCALE_DOWN=30
MEMORY_AVERAGE_PERIOD=300000

# Request Scaling Metrics
REQUEST_SCALING_ENABLED=true
REQUEST_SCALE_UP=1000
REQUEST_SCALE_DOWN=100
REQUEST_AVERAGE_PERIOD=60000

# Queue Scaling Metrics
QUEUE_SCALING_ENABLED=true
QUEUE_SCALE_UP=100
QUEUE_SCALE_DOWN=10
QUEUE_CHECK_PERIOD=30000

# PM2 Specific Settings
PM2_APP_NAME=estimate-service
PM2_EXEC_MODE=cluster
PM2_INSTANCES=max
PM2_MIN_INSTANCES=2
PM2_MAX_INSTANCES=10
PM2_CPU_UP=70
PM2_CPU_DOWN=20
PM2_MEMORY_UP=1024
PM2_MEMORY_DOWN=256
PM2_MAX_MEMORY_RESTART=1500M
PM2_MAX_RESTARTS=10
PM2_MIN_UPTIME=5000
PM2_LOG_MAX_SIZE=10M
PM2_LOG_RETAIN=10
PM2_LOG_COMPRESS=true

# Load Balancing
LB_ALGORITHM=round-robin
LB_STICKY_SESSION=false
LB_SESSION_TTL=3600
LB_HEALTH_CHECK=true
LB_HEALTH_PATH=/health
LB_HEALTH_INTERVAL=10
LB_HEALTH_TIMEOUT=5
LB_UNHEALTHY_THRESHOLD=3
LB_HEALTHY_THRESHOLD=2

# Service Discovery
SD_ENABLED=true
SD_PROVIDER=dns
SD_SERVICE_NAME=estimate-service
SD_TAGS=api,v1
SD_TTL=30
SD_REFRESH=20

# ===================================
# REDIS CONFIGURATION
# ===================================

REDIS_MODE=standalone
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_QUEUE_DB=1
CACHE_TTL=300
CACHE_MAX_KEYS=1000
REDIS_CONNECT_TIMEOUT=10000
REDIS_COMMAND_TIMEOUT=5000

# Bull Queue Settings
BULL_JOB_ATTEMPTS=3
BULL_BACKOFF_DELAY=2000
BULL_STALLED_INTERVAL=30000
BULL_MAX_STALLED_COUNT=3
BULL_GUARD_INTERVAL=5000
BULL_RETRY_DELAY=5000
BULL_LOCK_DURATION=30000
BULL_LOCK_RENEW_TIME=15000

# Redis Monitoring
REDIS_METRICS_ENABLED=true
REDIS_COMMAND_METRICS_ENABLED=true
REDIS_METRICS_INTERVAL=60000

# ===================================
# CIRCUIT BREAKER CONFIGURATION
# ===================================

# Default Settings
CB_FAILURE_THRESHOLD=5
CB_SUCCESS_THRESHOLD=3
CB_TIMEOUT=60000
CB_WINDOW_SIZE=10
CB_WINDOW_TIME=60000

# DeepSeek API
CB_DEEPSEEK_FAILURE_THRESHOLD=3
CB_DEEPSEEK_SUCCESS_THRESHOLD=2
CB_DEEPSEEK_TIMEOUT=30000
CB_DEEPSEEK_WINDOW_SIZE=15
CB_DEEPSEEK_WINDOW_TIME=120000

# HuggingFace API
CB_HF_FAILURE_THRESHOLD=5
CB_HF_SUCCESS_THRESHOLD=3
CB_HF_TIMEOUT=45000
CB_HF_WINDOW_SIZE=20
CB_HF_WINDOW_TIME=180000

# Circuit Breaker Monitoring
CB_LOG_STATE_CHANGES=true
CB_ENABLE_METRICS=true
CB_STATS_INTERVAL=30000
CB_ALERT_CRITICAL=50
CB_ALERT_WARNING=25

# ===================================
# NODE.JS OPTIMIZATION
# ===================================

# UV Thread Pool Size (for file I/O, DNS, etc.)
UV_THREADPOOL_SIZE=8

# Node.js Memory Options
NODE_OPTIONS=--max-old-space-size=1024 --optimize-for-size

# Garbage Collection
NODE_GC_INTERVAL=300000

# ===================================
# KUBERNETES SPECIFIC (if using K8s)
# ===================================

K8S_NAMESPACE=default
K8S_DEPLOYMENT=estimate-service
K8S_HPA_VERSION=v2
K8S_SCALE_UP_MAX=4
K8S_SCALE_UP_WINDOW=60
K8S_SCALE_UP_POLICY=Max
K8S_SCALE_DOWN_MAX=2
K8S_SCALE_DOWN_WINDOW=300
K8S_SCALE_DOWN_POLICY=Min
K8S_REQUEST_CPU=250m
K8S_REQUEST_MEMORY=512Mi
K8S_LIMIT_CPU=1000m
K8S_LIMIT_MEMORY=2Gi

# ===================================
# DOCKER SWARM SPECIFIC (if using Swarm)
# ===================================

SWARM_SERVICE=estimate-service
SWARM_MODE=replicated
SWARM_REPLICAS=2
SWARM_UPDATE_PARALLEL=1
SWARM_UPDATE_DELAY=10
SWARM_FAILURE_ACTION=rollback
SWARM_RESERVE_CPU=0.25
SWARM_RESERVE_MEMORY=512
SWARM_LIMIT_CPU=1.0
SWARM_LIMIT_MEMORY=2048
