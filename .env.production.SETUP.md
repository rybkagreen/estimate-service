# Production Environment Setup Guide

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- [–ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#–ø–æ—à–∞–≥–æ–≤–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ—Ç–ª–∞–¥–∫–∞)
- [–ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º](#—á–µ–∫-–ª–∏—Å—Ç-–ø–µ—Ä–µ–¥-–¥–µ–ø–ª–æ–µ–º)

## üîç –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ production –æ–∫—Ä—É–∂–µ–Ω–∏—è
–¥–ª—è Estimate Service. –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞ `.env.production` –¥–æ–ª–∂–Ω—ã
–±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º.

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–°–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

### 1. –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Å–µ–∫—Ä–µ—Ç–∞
openssl rand -base64 64

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Master API Key
openssl rand -hex 32

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
openssl rand -base64 32
```

### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- `DATABASE_URL` - connection string —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ credentials
- `DB_PASSWORD` - –ø–∞—Ä–æ–ª—å –ë–î (—Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º –º–µ–Ω–µ–¥–∂–µ—Ä–µ)
- SSL –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω: `sslmode=require` –∏–ª–∏ `sslmode=verify-full`

### 3. –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

- `DEEPSEEK_API_KEY` - –∫–ª—é—á –æ—Ç DeepSeek AI
- `GRAND_SMETA_API_KEY` - –∫–ª—é—á –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ì—Ä–∞–Ω–¥ –°–º–µ—Ç–∞
- `SENTRY_DSN` - –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫

## üìù –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

1. **AWS Secrets Manager** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞
aws secretsmanager create-secret \
  --name estimate-service/production \
  --secret-string '{
    "DB_PASSWORD": "your-secure-password",
    "JWT_SECRET_PROD": "your-jwt-secret",
    "MASTER_API_KEY_PROD": "your-master-key",
    "ENCRYPTION_KEY_PROD": "your-encryption-key",
    "REDIS_PASSWORD": "your-redis-password",
    "DEEPSEEK_API_KEY_PROD": "your-deepseek-key",
    "GRAND_SMETA_API_KEY_PROD": "your-grandsmeta-key",
    "SENTRY_DSN_PROD": "your-sentry-dsn"
  }'
```

2. **HashiCorp Vault**:

```bash
vault kv put secret/estimate-service/production \
  DB_PASSWORD="your-secure-password" \
  JWT_SECRET_PROD="your-jwt-secret" \
  # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏
```

3. **Azure Key Vault**:

```bash
az keyvault secret set \
  --vault-name "YourKeyVault" \
  --name "estimate-service-db-password" \
  --value "your-secure-password"
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

1. **AWS RDS PostgreSQL**:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ RDS instance
aws rds create-db-instance \
  --db-instance-identifier estimate-prod \
  --db-instance-class db.t3.medium \
  --engine postgres \
  --engine-version 15.4 \
  --master-username estimate_prod_user \
  --master-user-password ${DB_PASSWORD} \
  --allocated-storage 100 \
  --backup-retention-period 30 \
  --multi-az \
  --storage-encrypted

# –ü–æ–ª—É—á–µ–Ω–∏–µ endpoint
aws rds describe-db-instances \
  --db-instance-identifier estimate-prod \
  --query 'DBInstances[0].Endpoint.Address'
```

2. **Google Cloud SQL**:

```bash
gcloud sql instances create estimate-prod \
  --database-version=POSTGRES_15 \
  --cpu=2 \
  --memory=7680MB \
  --region=us-central1 \
  --backup \
  --backup-start-time=02:00 \
  --require-ssl
```

3. **Azure Database for PostgreSQL**:

```bash
az postgres server create \
  --name estimate-prod \
  --resource-group myResourceGroup \
  --location eastus \
  --admin-user estimate_admin \
  --admin-password ${DB_PASSWORD} \
  --sku-name GP_Gen5_2 \
  --version 15 \
  --ssl-enforcement Enabled
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Redis

1. **AWS ElastiCache**:

```bash
aws elasticache create-cache-cluster \
  --cache-cluster-id estimate-prod-cache \
  --engine redis \
  --cache-node-type cache.t3.micro \
  --num-cache-nodes 1 \
  --security-group-ids sg-12345678 \
  --auth-token ${REDIS_PASSWORD}
```

2. **Redis Cloud**:

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ API Redis Cloud
# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.redis.com/latest/rc/
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞ –∏ SSL

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS**:

```bash
# –ü—Ä–∏–º–µ—Ä –¥–ª—è Route 53
aws route53 change-resource-record-sets \
  --hosted-zone-id Z123456789 \
  --change-batch '{
    "Changes": [{
      "Action": "CREATE",
      "ResourceRecordSet": {
        "Name": "estimate.yourdomain.com",
        "Type": "A",
        "AliasTarget": {
          "HostedZoneId": "Z2FDTNDATAQYW2",
          "DNSName": "your-load-balancer.amazonaws.com",
          "EvaluateTargetHealth": true
        }
      }
    }]
  }'
```

2. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)**:

```bash
certbot certonly \
  --standalone \
  -d estimate.yourdomain.com \
  -d admin.estimate.yourdomain.com
```

## üìñ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

### –ü—Ä–∏–º–µ—Ä 1: AWS Production Setup

```env
# Database
DATABASE_URL="postgresql://app_user:${DB_PASSWORD}@estimate-prod.c123456.us-east-1.rds.amazonaws.com:5432/estimate_db?schema=public&sslmode=require"

# Redis
REDIS_URL="redis://:${REDIS_PASSWORD}@estimate-cache.abc123.ng.0001.use1.cache.amazonaws.com:6379/0"

# CORS
CORS_ORIGIN=https://app.mycompany.com,https://admin.mycompany.com

# Backup
BACKUP_S3_BUCKET=mycompany-estimate-backups-prod
BACKUP_S3_REGION=us-east-1
```

### –ü—Ä–∏–º–µ—Ä 2: Google Cloud Setup

```env
# Database (Cloud SQL with proxy)
DATABASE_URL="postgresql://app_user:${DB_PASSWORD}@/estimate_db?host=/cloudsql/project-id:us-central1:estimate-prod&sslmode=require"

# Redis (Memorystore)
REDIS_URL="redis://:${REDIS_PASSWORD}@10.0.0.3:6379/0"

# CORS
CORS_ORIGIN=https://estimate.mycompany.app
```

### –ü—Ä–∏–º–µ—Ä 3: On-Premise Setup

```env
# Database (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
DATABASE_URL="postgresql://app_user:${DB_PASSWORD}@db.internal.company.com:5432/estimate_prod?schema=public&sslmode=verify-full&sslcert=/certs/client.crt&sslkey=/certs/client.key&sslrootcert=/certs/ca.crt"

# Redis (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä)
REDIS_URL="redis://:${REDIS_PASSWORD}@redis.internal.company.com:6379/0"

# CORS (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–æ–º–µ–Ω)
CORS_ORIGIN=https://estimate.internal.company.com
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Security Groups (AWS)
aws ec2 create-security-group \
  --group-name estimate-prod-sg \
  --description "Security group for Estimate Service"

# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
aws ec2 authorize-security-group-ingress \
  --group-id sg-12345678 \
  --protocol tcp \
  --port 443 \
  --cidr 0.0.0.0/0

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - —Ç–æ–ª—å–∫–æ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
aws ec2 authorize-security-group-ingress \
  --group-id sg-database \
  --protocol tcp \
  --port 5432 \
  --source-group sg-12345678
```

### 2. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# –í–∫–ª—é—á–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è RDS
aws rds modify-db-instance \
  --db-instance-identifier estimate-prod \
  --storage-encrypted \
  --kms-key-id alias/aws/rds

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ S3 bucket –¥–ª—è –±—ç–∫–∞–ø–æ–≤
aws s3api put-bucket-encryption \
  --bucket mycompany-estimate-backups-prod \
  --server-side-encryption-configuration '{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "aws:kms",
        "KMSMasterKeyID": "alias/aws/s3"
      }
    }]
  }'
```

### 3. –ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –í–∫–ª—é—á–∏—Ç—å CloudTrail
aws cloudtrail create-trail \
  --name estimate-service-trail \
  --s3-bucket-name mycompany-cloudtrail-logs

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å VPC Flow Logs
aws ec2 create-flow-logs \
  --resource-type VPC \
  --resource-ids vpc-12345678 \
  --traffic-type ALL \
  --log-destination-type cloud-watch-logs \
  --log-group-name /aws/vpc/flowlogs
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### 1. Prometheus –º–µ—Ç—Ä–∏–∫–∏

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'estimate-service'
    static_configs:
      - targets: ['estimate.yourdomain.com:9090']
    metrics_path: '/metrics'
```

### 2. Grafana –¥–∞—à–±–æ—Ä–¥—ã

```json
{
  "dashboard": {
    "title": "Estimate Service Production",
    "panels": [
      {
        "title": "Request Rate",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])"
          }
        ]
      },
      {
        "title": "Database Connections",
        "targets": [
          {
            "expr": "pg_stat_database_numbackends"
          }
        ]
      }
    ]
  }
}
```

### 3. –ê–ª–µ—Ä—Ç—ã

```yaml
# alerting-rules.yml
groups:
  - name: estimate-service
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: 'High error rate detected'

      - alert: DatabaseConnectionsHigh
        expr: pg_stat_database_numbackends > 80
        for: 10m
        labels:
          severity: warning
```

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- [ ] –í—Å–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º –º–µ–Ω–µ–¥–∂–µ—Ä–µ
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –≤–∞–ª–∏–¥–Ω—ã
- [ ] Firewall –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è production –¥–æ–º–µ–Ω–æ–≤
- [ ] –í—Å–µ –ø–∞—Ä–æ–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø–æ–ª–∏—Ç–∏–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- [ ] Connection string —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ credentials
- [ ] SSL –≤–∫–ª—é—á–µ–Ω –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î
- [ ] –ë—ç–∫–∞–ø—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Read-—Ä–µ–ø–ª–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

- [ ] API –∫–ª—é—á–∏ –ø–æ–ª—É—á–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] IP –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- [ ] –¢–∞–π–º–∞—É—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- [ ] Sentry DSN –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Prometheus –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- [ ] –õ–æ–≥–∏ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Health checks —Ä–∞–±–æ—Ç–∞—é—Ç

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- [ ] Redis –∫–µ—à –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Connection pooling –≤–∫–ª—é—á–µ–Ω
- [ ] Compression –≤–∫–ª—é—á–µ–Ω
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ ] README –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞
- [ ] Runbook —Å–æ–∑–¥–∞–Ω –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
- [ ] –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —É–∫–∞–∑–∞–Ω—ã

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã

- DevOps –∫–æ–º–∞–Ω–¥–∞: devops@company.com
- DBA –∫–æ–º–∞–Ω–¥–∞: dba@company.com
- Security –∫–æ–º–∞–Ω–¥–∞: security@company.com

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

- DeepSeek API: https://platform.deepseek.com/support
- –ì—Ä–∞–Ω–¥ –°–º–µ—Ç–∞: support@grandsmeta.ru
- AWS Support: https://console.aws.amazon.com/support

### –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã

- On-call –∏–Ω–∂–µ–Ω–µ—Ä: +7 (XXX) XXX-XX-XX
- –≠—Å–∫–∞–ª–∞—Ü–∏—è: escalation@company.com

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: ${new Date().toISOString()} **–í–µ—Ä—Å–∏—è**: 1.0.0
